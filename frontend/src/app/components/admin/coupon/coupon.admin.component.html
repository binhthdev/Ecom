<div class="container">
  <h1>Quản lý phiếu giảm giá</h1>

  <!-- Search and Filter -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Tìm kiếm coupon..."
          [(ngModel)]="keyword"
          (keyup.enter)="onSearch()">
        <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">
          <i class="fas fa-search"></i> Tìm
        </button>
      </div>
    </div>
    <div class="col-md-3">
      <div class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          id="activeFilter"
          [(ngModel)]="activeFilter"
          (change)="onActiveFilterChange()">
        <label class="form-check-label" for="activeFilter">
          Chỉ hiện coupon đang hoạt động
        </label>
      </div>
    </div>
    <div class="col-md-3 text-end">
      <button class="btn btn-success" (click)="insertCoupon()">
        <i class="fas fa-plus"></i> Thêm coupon mới
      </button>
    </div>
  </div>

  <!-- Bảng phiếu giảm giá -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Mã</th>
          <th>Tên</th>
          <th>Loại giảm</th>
          <th>Giá trị</th>
          <th>Đơn tối thiểu</th>
          <th>Giới hạn sử dụng</th>
          <th>Đã sử dụng</th>
          <th>Trạng thái</th>
          <th>Thời gian</th>
          <th>Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let coupon of coupons" [class.table-secondary]="!coupon.active">
          <td>{{ coupon.id }}</td>
          <td>
            <span class="badge bg-primary fs-6">{{ coupon.code }}</span>
          </td>
          <td>
            <strong>{{ coupon.name }}</strong>
            <br>
            <small class="text-muted">{{ coupon.description }}</small>
          </td>
          <td>
            <span class="badge" [class]="coupon.discountType === 'PERCENT' ? 'bg-success' : 'bg-info'">
              {{ coupon.discountType === 'PERCENT' ? 'Phần trăm' : 'Cố định' }}
            </span>
          </td>
          <td>
            <strong class="text-success">
              {{ coupon.discountType === 'PERCENT' ? coupon.discountValue + '%' : formatCurrency(coupon.discountValue) }}
            </strong>
          </td>
          <td>
            {{ coupon.minimumOrderAmount ? formatCurrency(coupon.minimumOrderAmount) : 'Không giới hạn' }}
          </td>
          <td>
            {{ coupon.usageLimit || 'Không giới hạn' }}
          </td>
          <td>
            <span class="badge bg-warning">{{ coupon.usedCount || 0 }}</span>
          </td>
          <td>
            <span class="badge" [class]="coupon.active ? 'bg-success' : 'bg-danger'">
              {{ coupon.active ? 'Hoạt động' : 'Không hoạt động' }}
            </span>
          </td>
          <td>
            <small>
              Bắt đầu: {{ formatDate(coupon.startDate) }}<br>
              Kết thúc: {{ formatDate(coupon.endDate) }}
            </small>
          </td>
          <td>
            <div class="btn-group-vertical btn-group-sm" role="group">
              <button
                class="btn btn-outline-primary btn-sm"
                (click)="validateCoupon(coupon)"
                title="Kiểm tra coupon">
                <i class="fas fa-check-circle"></i> Kiểm tra
              </button>
              <button
                class="btn btn-outline-warning btn-sm"
                (click)="updateCoupon(coupon.id)"
                title="Chỉnh sửa">
                <i class="fas fa-edit"></i> Sửa
              </button>
              <button
                class="btn btn-outline-danger btn-sm"
                (click)="deleteCoupon(coupon)"
                title="Xóa">
                <i class="fas fa-trash"></i> Xóa
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="coupons.length === 0">
          <td colspan="11" class="text-center text-muted">
            <i class="fas fa-inbox fa-2x mb-2"></i><br>
            Không có coupon nào
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-3" *ngIf="totalPages > 1">
    <nav aria-label="Phiếu giảm giá pagination">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" href="#" (click)="onPageChange(currentPage - 1); $event.preventDefault()">
            Trước
          </a>
        </li>
        <li
          class="page-item"
          *ngFor="let page of [].constructor(totalPages); let i = index"
          [class.active]="i === currentPage">
          <a class="page-link" href="#" (click)="onPageChange(i); $event.preventDefault()">
            {{ i + 1 }}
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
          <a class="page-link" href="#" (click)="onPageChange(currentPage + 1); $event.preventDefault()">
            Sau
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Statistics -->
  <!-- <div class="row mt-3">
    <div class="col-md-12">
      <div class="alert alert-info">
        <h6><i class="fas fa-chart-bar"></i> Thống kê</h6>
        <p class="mb-0">
          Tổng số coupon: <strong>{{ totalElements }}</strong> |
          Trang hiện tại: <strong>{{ currentPage + 1 }}/{{ totalPages }}</strong>
        </p>
      </div>
    </div>
  </div> -->
</div>
