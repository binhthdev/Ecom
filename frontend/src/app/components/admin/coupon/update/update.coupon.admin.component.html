<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h4 class="mb-0">
            <i class="fas fa-edit"></i> Cập nhật Mã giảm giá
          </h4>
        </div>
        <div class="card-body">
          <form #couponForm="ngForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <!-- Code -->
              <div class="col-md-6 mb-3">
                <label for="code" class="form-label">
                  Mã Code <span class="text-danger">*</span>
                </label>
                <input type="text"
                       class="form-control"
                       id="code"
                       name="code"
                       [(ngModel)]="updateCouponDTO.code"
                       required
                       placeholder="Nhập mã code duy nhất">
                <div class="form-text">Mã code sẽ được sử dụng để áp dụng coupon</div>
              </div>

              <!-- Name -->
              <div class="col-md-6 mb-3">
                <label for="name" class="form-label">
                  Tên Mã giảm giá <span class="text-danger">*</span>
                </label>
                <input type="text"
                       class="form-control"
                       id="name"
                       name="name"
                       [(ngModel)]="updateCouponDTO.name"
                       required
                       placeholder="Nhập tên coupon">
              </div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label for="description" class="form-label">Mô tả</label>
              <textarea class="form-control"
                        id="description"
                        name="description"
                        [(ngModel)]="updateCouponDTO.description"
                        rows="3"
                        placeholder="Mô tả chi tiết về coupon (tùy chọn)"></textarea>
            </div>

            <div class="row">
              <!-- Discount Type -->
              <div class="col-md-6 mb-3">
                <label for="discountType" class="form-label">
                  Loại giảm giá <span class="text-danger">*</span>
                </label>
                <select class="form-select"
                        id="discountType"
                        name="discountType"
                        [(ngModel)]="updateCouponDTO.discountType"
                        (change)="onDiscountTypeChange()"
                        required>
                  <option *ngFor="let type of discountTypes" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
              </div>

              <!-- Discount Value -->
              <div class="col-md-6 mb-3">
                <label for="discountValue" class="form-label">
                  Giá trị giảm <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <input type="number"
                         class="form-control"
                         id="discountValue"
                         name="discountValue"
                         [(ngModel)]="updateCouponDTO.discountValue"
                         required
                         min="0.01"
                         step="0.01"
                         placeholder="Nhập giá trị giảm">
                  <span class="input-group-text">
                    <span *ngIf="updateCouponDTO.discountType === 'PERCENT'">%</span>
                    <span *ngIf="updateCouponDTO.discountType === 'FIXED'">VND</span>
                  </span>
                </div>
                <div class="form-text" *ngIf="updateCouponDTO.discountType === 'PERCENT'">
                  Giá trị từ 1% đến 100%
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Minimum Order Amount -->
              <div class="col-md-6 mb-3">
                <label for="minimumOrderAmount" class="form-label">
                  Đơn hàng tối thiểu
                </label>
                <div class="input-group">
                  <input type="number"
                         class="form-control"
                         id="minimumOrderAmount"
                         name="minimumOrderAmount"
                         [(ngModel)]="updateCouponDTO.minimumOrderAmount"
                         min="0"
                         step="1000"
                         placeholder="0">
                  <span class="input-group-text">VND</span>
                </div>
                <div class="form-text">Để trống nếu không giới hạn</div>
              </div>

              <!-- Maximum Discount -->
              <div class="col-md-6 mb-3">
                <label for="maximumDiscount" class="form-label">
                  Giảm tối đa
                </label>
                <div class="input-group">
                  <input type="number"
                         class="form-control"
                         id="maximumDiscount"
                         name="maximumDiscount"
                         [(ngModel)]="updateCouponDTO.maximumDiscount"
                         min="0"
                         step="1000"
                         placeholder="0">
                  <span class="input-group-text">VND</span>
                </div>
                <div class="form-text">Chỉ áp dụng cho giảm phần trăm</div>
              </div>
            </div>

            <div class="row">
              <!-- Start Date -->
              <div class="col-md-6 mb-3">
                <label for="startDate" class="form-label">
                  Ngày bắt đầu <span class="text-danger">*</span>
                </label>
                <input type="datetime-local"
                       class="form-control"
                       id="startDate"
                       name="startDate"
                       [(ngModel)]="updateCouponDTO.startDate"
                       required>
              </div>

              <!-- End Date -->
              <div class="col-md-6 mb-3">
                <label for="endDate" class="form-label">
                  Ngày kết thúc <span class="text-danger">*</span>
                </label>
                <input type="datetime-local"
                       class="form-control"
                       id="endDate"
                       name="endDate"
                       [(ngModel)]="updateCouponDTO.endDate"
                       required>
              </div>
            </div>

            <div class="row">
              <!-- Usage Limit -->
              <div class="col-md-6 mb-3">
                <label for="usageLimit" class="form-label">
                  Giới hạn sử dụng
                </label>
                <input type="number"
                       class="form-control"
                       id="usageLimit"
                       name="usageLimit"
                       [(ngModel)]="updateCouponDTO.usageLimit"
                       min="1"
                       placeholder="Để trống nếu không giới hạn">
                <div class="form-text">
                  Số lần coupon có thể được sử dụng
                  <br>
                  <small class="text-muted">Đã sử dụng: {{ coupon.usedCount || 0 }}</small>
                </div>
              </div>

              <!-- Active -->
              <div class="col-md-6 mb-3">
                <label class="form-label">Trạng thái</label>
                <div class="form-check">
                  <input class="form-check-input"
                         type="checkbox"
                         id="active"
                         name="active"
                         [(ngModel)]="updateCouponDTO.active">
                  <label class="form-check-label" for="active">
                    Kích hoạt coupon
                  </label>
                </div>
              </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-end gap-2">
              <button type="button"
                      class="btn btn-secondary"
                      (click)="onCancel()">
                <i class="fas fa-times"></i> Hủy
              </button>
              <button type="submit"
                      class="btn btn-primary"
                      [disabled]="!couponForm.form.valid">
                <i class="fas fa-save"></i> Cập nhật
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
