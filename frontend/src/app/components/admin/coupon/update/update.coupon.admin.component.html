<div class="container" *ngIf="!loading; else loadingTemplate">
  <div class="row">
    <div class="col-md-12">
      <h3 class="text-center">
        <i class="fas fa-edit"></i> Chỉnh sửa phiếu giảm giá
      </h3>
      <p class="text-center text-muted mb-4">ID: {{ couponId }}</p>
      <form (ngSubmit)="onSubmit()">
        <!-- Mã phiếu giảm giá -->
        <div class="mb-3">
          <label for="code" class="form-label required">Mã phiếu giảm giá</label>
          <input
            type="text"
            class="form-control"
            id="code"
            [(ngModel)]="couponDTO.code"
            name="code"
            required>
          <div class="form-text">Mã duy nhất để khách hàng sử dụng</div>
        </div>

        <!-- Tên phiếu giảm giá -->
        <div class="mb-3">
          <label for="name" class="form-label required">Tên phiếu giảm giá</label>
          <input
            type="text"
            class="form-control"
            id="name"
            [(ngModel)]="couponDTO.name"
            name="name"
            required>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label for="description" class="form-label">Mô tả</label>
          <textarea
            class="form-control"
            id="description"
            [(ngModel)]="couponDTO.description"
            name="description"
            rows="3">
          </textarea>
        </div>

        <!-- Discount Type -->
        <div class="mb-3">
          <label class="form-label required">Loại giảm giá</label>
          <div class="row">
            <div class="col-md-6">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  id="percent"
                  [(ngModel)]="couponDTO.discountType"
                  name="discountType"
                  value="PERCENT"
                  (change)="onDiscountTypeChange()"
                  checked>
                <label class="form-check-label" for="percent">
                  Giảm phần trăm (%)
                </label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  id="fixed"
                  [(ngModel)]="couponDTO.discountType"
                  name="discountType"
                  value="FIXED"
                  (change)="onDiscountTypeChange()">
                <label class="form-check-label" for="fixed">
                  Giảm cố định (VNĐ)
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Discount Value -->
        <div class="mb-3">
          <label for="discountValue" class="form-label required">
            Giá trị giảm
            <span *ngIf="couponDTO.discountType === 'PERCENT'">(%)</span>
            <span *ngIf="couponDTO.discountType === 'FIXED'">(VNĐ)</span>
          </label>
          <input
            type="number"
            class="form-control"
            id="discountValue"
            [(ngModel)]="couponDTO.discountValue"
            name="discountValue"
            [min]="1"
            [max]="couponDTO.discountType === 'PERCENT' ? 100 : 99999999"
            required>
          <div class="form-text" *ngIf="couponDTO.discountType === 'PERCENT'">
            Giá trị từ 1-100%
          </div>
        </div>

        <!-- Minimum Order Amount -->
        <div class="mb-3">
          <label for="minimumOrderAmount" class="form-label">Đơn hàng tối thiểu (VNĐ)</label>
          <input
            type="number"
            class="form-control"
            id="minimumOrderAmount"
            [(ngModel)]="couponDTO.minimumOrderAmount"
            name="minimumOrderAmount"
            min="0">
          <div class="form-text">Đơn hàng phải đạt giá trị tối thiểu để sử dụng coupon</div>
        </div>

        <!-- Maximum Discount (only for percent type) -->
        <div class="mb-3" *ngIf="couponDTO.discountType === 'PERCENT'">
          <label for="maximumDiscount" class="form-label">Giảm tối đa (VNĐ)</label>
          <input
            type="number"
            class="form-control"
            id="maximumDiscount"
            [(ngModel)]="couponDTO.maximumDiscount"
            name="maximumDiscount"
            min="0">
          <div class="form-text">Giới hạn số tiền giảm tối đa cho coupon phần trăm</div>
        </div>

        <!-- Date Range -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="startDate" class="form-label required">Ngày bắt đầu</label>
            <input
              type="datetime-local"
              class="form-control"
              id="startDate"
              [(ngModel)]="couponDTO.startDate"
              name="startDate"
              required>
          </div>
          <div class="col-md-6">
            <label for="endDate" class="form-label required">Ngày kết thúc</label>
            <input
              type="datetime-local"
              class="form-control"
              id="endDate"
              [(ngModel)]="couponDTO.endDate"
              name="endDate"
              required>
          </div>
        </div>

        <!-- Usage Limit -->
        <div class="mb-3">
          <label for="usageLimit" class="form-label">Giới hạn sử dụng</label>
          <input
            type="number"
            class="form-control"
            id="usageLimit"
            [(ngModel)]="couponDTO.usageLimit"
            name="usageLimit"
            min="1">
          <div class="form-text">Số lần coupon có thể được sử dụng</div>
        </div>

        <!-- Active Status -->
        <div class="mb-3">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="active"
              [(ngModel)]="couponDTO.active"
              name="active">
            <label class="form-check-label" for="active">
              Kích hoạt coupon
            </label>
          </div>
        </div>

        <!-- Current Usage Info -->
        <div class="alert alert-info mb-3" *ngIf="coupon">
          <h6><i class="fas fa-info-circle"></i> Thông tin hiện tại</h6>
          <p class="mb-1">Đã được sử dụng: <strong>{{ coupon.usedCount || 0 }}</strong> lần</p>
          <p class="mb-0">Ngày tạo: <strong>{{ formatDateForInput(coupon.createdAt) | date:'dd/MM/yyyy HH:mm' }}</strong></p>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2 justify-content-end mt-4 mb-4">
          <button type="button" class="btn btn-secondary" (click)="onCancel()">
            <i class="fas fa-times"></i> Hủy
          </button>
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Cập nhật phiếu giảm giá
              </button>
        </div>
      </form>
    </div>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="container text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Đang tải...</span>
    </div>
    <p class="mt-3">Đang tải thông tin coupon...</p>
  </div>
</ng-template>
